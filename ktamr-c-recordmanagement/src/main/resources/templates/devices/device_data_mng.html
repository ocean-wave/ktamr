<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="include :: header">
    <meta charset="UTF-8">
    <title>Title</title>
</head>
</head>
<body class="myPage-body">
<div class="container myContainer">
    <div class="row" style="margin:0;padding:5px 0px;">
        <div class="col-sm-4 col-md-4 my-form-no-edge">
            <div class="row my-form-no-edge">
                <div class="col-xs-2 my-form-col" style="width:173px;">
                    <div class="btn-group" data-toggle="buttons">
                        <label class="btn btn-sm btn-default">
                            <input type="radio" name="options" data-title="centor" checked >集中器
                        </label>
                        <label class="btn btn-sm btn-default">
                            <input type="radio" name="options" data-title="ccentor">集采器
                        </label>
                        <label class="btn btn-sm btn-default">
                            <input type="radio" name="options" data-title="handDevice">手抄器
                        </label>
                    </div>
                </div>
                <div class="col-xs-5 my-form-col my-tree-class areaTreeDiv">
                    <input id="nodeType" type="text" class="input-sm form-control hide" value="">
                    <input id="nodeIds" type="text" class="input-sm form-control hide" value="">
                    <input id="areaSel" name="areaSel" type="text" readonly class="input-sm form-control"  placeholder="---请选择区域---"/>
                    <div id="menuContent" class="menuContent">
                        <div class="ztreeInput">
                            <div>
                                <input type="text" class="input-key input-sm form-control" id="zTreeKey" placeholder="请输入节点关键字">
                            </div>
                            <div class="ztreeSkip">
                                <label type="text" id="resultKey" class="form-control ztreeSkipLabel">
                                    <div class="ztreeSkipBtns">
                                        <a id="clickUp" class="glyphicon glyphicon-menu-up ztreeSkipUp"></a>
                                        <a id="clickDown" class="glyphicon glyphicon-menu-down ztreeSkipDown"></a>
                                    </div>
                                    <label id="number" class="ztreeSkipNum"></label>
                                </label>
                            </div>
                        </div>
                        <ul id="areaTree" class="ztree"></ul>
                        <div class="clearfloat"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-8 col-md-8 my-form-no-edge">
            <div id="nav1" class="centor" name="centorNav" style="display:block;">
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-plus"></span> 新增<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.新增集中器</a></li>
                        <li><a href="#" >2.新增采集器</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-pencil"></span> 修改<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.修改集中器</a></li>
                        <li><a href="#" >2.修改采集器</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-trash"></span> 删除<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.删除集中器</a></li>
                        <li><a href="#" >2.删除采集器</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-link"></span> 关联<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.采集器选择表</a></li>
                        <li><a href="#" >2.采集器关联表</a></li>
                        <li><a href="#" >3.表选择采集器</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button data-modal="" data-title="取消关联设备" class="layui-btn layui-btn-sm"><img src="../../images/delete.png" />&nbsp;取消关联设备</button>
                </div>
                <div class="btn-group btnMargin">
                    <button data-modal="" data-title="导入" class="layui-btn layui-btn-sm"><span class="glyphicon glyphicon-upload"></span>&nbsp;导入</button>
                </div>
            </div>

            <div id="nav2" class="ccentor" name="ccentorNav" style="display:none;">
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-plus"></span> 新增<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.新增集采器</a></li>
                        <li><a href="#" >2.新增端口</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-pencil"></span> 修改<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.修改集采器</a></li>
                        <li><a href="#" >2.修改端口</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-trash"></span> 删除<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.删除集采器</a></li>
                        <li><a href="#" >2.删除端口</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-link"></span> 关联<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.端口选择表</a></li>
                        <li><a href="#" >2.端口关联表</a></li>
                        <li><a href="#" >3.表选择端口</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button data-modal="" data-title="取消关联设备" class="layui-btn layui-btn-sm"><img src="../../images/delete.png" />&nbsp;取消关联设备</button>
                </div>
                <div class="btn-group btnMargin">
                    <button data-modal="" data-title="导入" class="layui-btn layui-btn-sm"><span class="glyphicon glyphicon-upload"></span>&nbsp;导入</button>
                </div>
            </div>

            <div id="nav3" class="handDevice" name="handDeviceNav" style="display:none;">
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-plus"></span> 新增<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.新增抄收线路</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-pencil"></span> 修改<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.修改抄收线路</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-trash"></span> 删除<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.删除抄收线路</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button type="button" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown"><span class="glyphicon glyphicon-link"></span> 关联<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" >1.线路选择表</a></li>
                        <li><a href="#" >2.线路关联表</a></li>
                        <li><a href="#" >3.表选择线路</a></li>
                    </ul>
                </div>
                <div class="btn-group btnMargin">
                    <button data-modal="" data-title="导入" class="layui-btn layui-btn-sm"><span class="glyphicon glyphicon-upload"></span>&nbsp;导入</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row my-form-no-edge">
        <div class="col-xs-4 my-form-no-edge" style="padding-right: 1px;">
            <form class="form-horizontal" id="jqgridForm1" role="form">
                <table id="jqGrid1" rel="jqgridForm1" data-height="100%" class="jqgrid"></table>
                <div id="jqGridPager1"></div>
            </form>
        </div>
        <div class="col-xs-8 my-form-no-edge">
            <form class="form-horizontal" id="jqgridForm2" role="form">
                <div id="collectorList" style="padding-bottom:1px;">
                    <table id="jqGrid2" rel="jqgridForm2" data-height="40%" class="jqgrid"></table>
                    <div id="jqGridPager2"></div>
                </div>
                <div id="meterList">
                    <table id="jqGrid3" rel="jqgridForm2" data-height="60%" class="jqgrid"></table>
                    <div id="jqGridPager3"></div>
                </div>
            </form>
        </div>
    </div>
</div>
<div th:include="include :: footer"></div>
<script language="JavaScript">
    layui.config({
        base : '/common/js/',
        version: '2.8.2'
    }).extend({
        myLayui: 'myLayui'
    });
    var _myLayui = null;
    layui.use(['layer', 'form', 'myLayui'], function(){
        var layer = layui.layer,
            myLayui = layui.myLayui,
            form = layui.form;
        var deviceType = "centor";
        var Post_Data1 = {ListNumber: 31, deviceType: deviceType};
        var Post_Data2 = {ListNumber: 33, centorId: "-1"};
        var Post_Data3 = {ListNumber: 32, centorId: "-1", collectorId: ""};
        var lastSel,lastSel2;
        var meterListHightPercent = 0.6;
        var zOption = {
            // url: "../client_trans/getAreaNodes.asp",
            url:"/area/ShowBigName23",
            selectedMulti: true,
            nodeTypeId: "nodeType",
            nodeIdsId: "nodeIds",
            nodeNamesId: "areaSel",
            clickCallBack: gridDataReload
        };
        var tree = new myzTree("areaTree", zOption);
        tree.dropDownTreeOpen();
        tree.fuzzySearch("zTreeKey", "clickUp", "clickDown", "number");
        $("#areaSel").click(function(){
            tree.showMenu();
        });
        dropdownOpen();//按键组下拉菜单调用
        function gridDataReload(){
            deviceType = $('input:radio[name="options"]:checked').data("title");
            var _postData = $("#jqGrid1").getGridParam("postData");
            var postDataArray = {
                "deviceType": deviceType,
                "nodeType": $("#nodeType").val(),
                "nodeIds": $("#nodeIds").val()
            };
            if(_postData != undefined){
                $.each(postDataArray, function (k, v) {
                    _postData[k] = v;
                });
            }
            //console.log(_postData);
            $("#jqGrid1").jqGrid('setGridParam',{
                page:1,
                postData: _postData
            }).trigger("reloadGrid");
            $("#jqGrid2").jqGrid('setGridParam',{
                postData: Post_Data2
            }).trigger("reloadGrid");
            $("#jqGrid3").jqGrid('setGridParam',{
                postData: Post_Data3
            }).trigger("reloadGrid");
        }
        //初始选择设备类型
        var initOp = {
            heightDelta: 150,
            gridIds: ['jqGrid1','jqGrid2','jqGrid3'],
            formIds: ['jqgridForm1','jqgridForm2','jqgridForm2'],
            gridMinHeight: [300, 100, 100],
            gridHeightPercent: ['100%', '40%', '60%']
        };
        $('input:radio[name="options"]:checked').parent('label').addClass('active');
        $('input:radio[name="options"]').change(function(){
            deviceType = $('input:radio[name="options"]:checked').data("title");
            if(deviceType == "centor"){
                $("#nav2").hide();
                $("#nav3").hide();
                $("#nav1").show();
                $("#jqGrid1").jqGrid('setCaption', "集中器列表：");
                $("#jqGrid2").jqGrid('setCaption', "采集器列表：");
                initOp.gridHeightPercent =  ['100%', '40%', '60%'];
                initOp.gridMinHeight = [300, 100, 100];
                setGridsSize1(initOp);
                resizeGrids1(initOp);
                $("#collectorList").show();
            }else if(deviceType == "ccentor"){
                $("#nav1").hide();
                $("#nav3").hide();
                $("#nav2").show();
                $("#jqGrid1").jqGrid('setCaption', "集采器列表：");
                $("#jqGrid2").jqGrid('setCaption', "端口列表：");
                initOp.gridHeightPercent = ['100%', '40%', '60%'];
                initOp.gridMinHeight = [300, 100, 100];
                setGridsSize1(initOp);
                resizeGrids1(initOp);
                $("#collectorList").show();
            }else if(deviceType == "handDevice"){
                $("#nav1").hide();
                $("#nav2").hide();
                $("#nav3").show();
                $("#jqGrid1").jqGrid('setCaption', "抄收线路列表：");
                initOp.gridHeightPercent = ['100%', '40%', '100%'];
                initOp.gridMinHeight = [200, 100, 100];
                setGridsSize1(initOp);
                resizeGrids1(initOp);
                $("#collectorList").hide();
            }
            gridDataReload();
        });



        var GridObj = new myJqGrid("jqGrid1", "jqGridPager1", "jqgridForm1", 288,"/devices/deviceDataMngJson");
        GridObj.jqdefaultGridConfig.caption = "集中器列表：";
        GridObj.jqdefaultGridConfig.scroll = true;
        GridObj.jqdefaultGridConfig.postData = Post_Data1;
        // GridObj.jqdefaultGridConfig.jsonReader.rows="rows";
        // GridObj.jqdefaultGridConfig.jsonReader.id="id";
        // GridObj.jqdefaultGridConfig.jsonReader.page="page";
        // GridObj.jqdefaultGridConfig.jsonReader.total="total";
        // GridObj.jqdefaultGridConfig.jsonReader.records="records";
        // GridObj.jqdefaultGridConfig.jsonReader.repeatitems=false;
        GridObj.jqdefaultGridConfig.colNames = ['id','编号','设备名称','设备地址','连接说明','状态','所属小区'];
        GridObj.jqdefaultGridConfig.colModel = [
            { name: 'id',  width: 75, key: true, hidden: true},
            { name: 'centorNo', width: 100 },
            { name: 'addr', width: 100 },
            { name: 'centorId', width: 80 },
            { name: 'descripton', width: 100 },
            { name: 'state', width: 80, hidden: true },
            { name: 'haArea.name', width: 100 }
        ];
        GridObj.jqdefaultGridConfig.onSelectRow = function(id){
            if(id && id!==lastSel){
                $("#jqGrid2").jqGrid('setGridParam',{
                    postData: {"centorId":id}
                }).trigger("reloadGrid");
                $("#jqGrid3").jqGrid('setGridParam',{
                    postData: {"areaId": id}
                }).trigger("reloadGrid");
            }
        }
        GridObj.drawGrid();
        GridObj.drawGridPager();

        var GridObj2 = new myJqGrid("jqGrid2", "jqGridPager2", "jqgridForm2", 288,"/devices/QueryHaCollector");
        GridObj2.jqdefaultGridConfig.caption = "采集器列表：";
        GridObj2.jqdefaultGridConfig.scroll = true;
        GridObj2.jqdefaultGridConfig.postData = Post_Data2;
        GridObj2.jqdefaultGridConfig.colNames = ['collectorId','设备名称','设备类型','设备地址','状态'];
        GridObj2.jqdefaultGridConfig.colModel = [
            { name: 'collectorId',  width: 75, key: true, hidden: true},
            { name: 'addr', width: 180 },
            { name: 'ver', width: 80 },
            { name: 'nconf', width: 80 },
            { name: 'state', width: 100 }
        ];
        GridObj2.jqdefaultGridConfig.onSelectRow = function(id){
            if(id && id!==lastSel2){
                lastSel2=id;
                $("#jqGrid3").jqGrid('setGridParam',{
                    postData: {"collectorid": id}
                }).trigger("reloadGrid");
            }
        };
        GridObj2.drawGrid();
        GridObj2.drawGridPager();

        var GridObj3 = new myJqGrid("jqGrid3", "jqGridPager3", "jqgridForm2", 288,"/meter/queryHaMeter");
        GridObj3.jqdefaultGridConfig.caption = "表列表：";
        GridObj3.jqdefaultGridConfig.multiselect = true;
        GridObj3.jqdefaultGridConfig.postData = Post_Data3;
        GridObj3.jqdefaultGridConfig.colNames = ['meterid','用户编号','用户名称','用户地址','表号'];
        GridObj3.jqdefaultGridConfig.colModel = [
            { name: 'meterId',  width: 75, key: true, hidden: true},
            { name: 'havMeterinfo.userNo', width: 80 },
            { name: 'havMeterinfo.userName', width: 100 },
            { name: 'havMeterinfo.userDs', width: 180 },
            { name: 'meterNumber', width: 100 }
        ];
        GridObj3.drawGrid();
        GridObj3.drawGridPager();

        function setGridsSize1(op) {
            var gridCount = 0, i=0;
            var winHeight = $(window).height(), gridWidth = 100, gridHeight = 100;
            var gridHeight0 = 0, gridHeight1=0, gridHeight2=0;
            if(op != ""){
                gridCount = op.gridIds.length;
            }else{
                return false;
            }
            for(i=0 ; i<gridCount; i++){
                gridWidth = $("#" + op.formIds[i]).width();
                $("#"+op.gridIds[i]).setGridWidth(gridWidth, false);
            }
            gridHeight0 = winHeight - op.heightDelta;
            if(gridHeight0 < op.gridMinHeight[0]){
                gridHeight0 = op.gridMinHeight[0];
            }
            gridHeight0 = (gridHeight0)*parseInt(op.gridHeightPercent[0])/100;
            gridHeight1 = (gridHeight0 + 104)*parseInt(op.gridHeightPercent[1])/100 -107;
            gridHeight2 = (gridHeight0 + 104)*parseInt(op.gridHeightPercent[2])/100 -105;

            $("#"+op.gridIds[0]).setGridHeight(gridHeight0);
            $("#"+op.gridIds[1]).setGridHeight(gridHeight1);
            $("#"+op.gridIds[2]).setGridHeight(gridHeight2);
        }
        function resizeGrids1(op) {
            $(window).bind('resize', function (){
                $(window).unbind("onresize");
                setGridsSize1(op);
                $(window).bind("onresize", this);
            });
        }

        setGridsSize1(initOp);
        resizeGrids1(initOp);

        function delDevice(url, queryString, device){
            //var _url;x`
            //var _queryString = queryString.join("&");
            //_url = url+"?"+_queryString;
            $.ajax({
                url: url
                //,context: $("#"+GridId)
                ,data: queryString
                ,type: "POST"
                ,contentType:'application/x-www-form-urlencoded; charset=UTF-8'
                ,async:true //异步请求
                ,success: function(data){
                    if(data == "true"){
                        layer.msg("操作成功！", {icon: 1});
                        if(device == "centor"){
                            $("#jqGrid1").trigger("reloadGrid");
                            $("#jqGrid2").trigger("reloadGrid");
                            $("#jqGrid3").trigger("reloadGrid");
                        }else if(device == "collector"){
                            $("#jqGrid2").trigger("reloadGrid");
                            $("#jqGrid3").trigger("reloadGrid");
                        }
                    }else{
                        layer.msg(data, {icon: 5});
                    }
                }
            });
        }
        _myLayui = new myLayui;
        $(".btn-group a").click(function(){
            var cmdName = $(this).text();
            var deviceId = getSelectedRows("jqGrid1");
            var _layerSize = ['580px', '400px'];
            arry = cmdName.split(".");
            cmdName = arry[1];
            var _queryStr = [
                "deviceId="+deviceId
            ];
            switch(cmdName){
                case "新增集中器":
                case "新增集采器":
                case "新增抄收线路":
                    _layerSize = ['560px', '480px'];
                    _queryStr = [
                        "cmdName="+cmdName
                    ]
                    _myLayui.showLayer(cmdName, "/devices/JumpCentorAdd", _queryStr, _layerSize);
                    break;
                case "新增采集器":
                case "新增端口":
                    var deviceId = getSelectedRows("jqGrid1");
                    if(deviceId == ""){
                        if(deviceType == "centor")
                            layer.msg("请选择集中器！", {icon: 5});
                        else if(deviceType == "ccentor")
                            layer.msg("请选择集采器！", {icon: 5});
                    }else{
                        _layerSize = ['455px', '300px'];
                        _queryStr = [
                            "cmdName="+cmdName,
                            "deviceId="+deviceId
                        ];
                        _myLayui.showLayer(cmdName, "/devices/JumpCollectorAdd", _queryStr, _layerSize);
                    }
                    break;

                case "修改集中器":
                case "修改集采器":
                case "修改抄收线路":
                    var deviceId = getSelectedRows("jqGrid1");
                    if(deviceId == ""){
                        if(deviceType == "centor")
                            layer.msg("请选择集中器！", {icon: 5});
                        else if(deviceType == "ccentor")
                            layer.msg("请选择集采器！", {icon: 5});
                        else if(deviceType == "handDevice")
                            layer.msg("请选择抄收线路！", {icon: 5});
                    }else{
                        _layerSize = ['560px', '480px'];
                        _queryStr = [
                            "cmdName="+cmdName,
                            "deviceId="+deviceId
                        ];
                        _myLayui.showLayer(cmdName, "./centor_update.asp", _queryStr, _layerSize);
                    }
                    break;

                case "修改采集器":
                case "修改端口":
                    var collectorId = getSelectedRows("jqGrid2");
                    if(collectorId == ""){
                        if(deviceType == "centor")
                            layer.msg("请选择采集器！", {icon: 5});
                        else if(deviceType == "ccentor")
                            layer.msg("请选择端口！", {icon: 5});
                    }else{
                        _layerSize = ['455px', '300px'];
                        _queryStr = [
                            "cmdName="+cmdName,
                            "collectorId="+collectorId
                        ];
                        _myLayui.showLayer(cmdName, "./collector_update.asp", _queryStr, _layerSize);
                    }
                    break;

                case "删除集中器":
                case "删除集采器":
                case "删除抄收线路":
                    var deviceId = getSelectedRows("jqGrid1");
                    if(deviceId == ""){
                        if(deviceType == "centor")
                            layer.msg("请选择集中器！", {icon: 5});
                        else if(deviceType == "ccentor")
                            layer.msg("请选择集采器！", {icon: 5});
                        else if(deviceType == "handDevice")
                            layer.msg("请选择抄收线路！", {icon: 5});
                    }else{
                        _queryStr = {
                            "cmdName": cmdName,
                            "deviceId": deviceId
                        };
                        layer.confirm('确实要删除档案吗？', {icon:3, title:'提示'},
                            function(index, layero){
                                delDevice("./centor_del_do.asp", _queryStr, "centor");
                                layer.close(index);
                            });
                    }
                    break;
                case "删除采集器":
                case "删除端口":
                    var collectorId = getSelectedRows("jqGrid2");
                    if(collectorId == ""){
                        if(deviceType == "centor")
                            layer.msg("请选择采集器！", {icon: 5});
                        else if(deviceType == "ccentor")
                            layer.msg("请选择端口！", {icon: 5});
                    }else{
                        _queryStr = {
                            "cmdName": cmdName,
                            "collectorId": collectorId
                        };
                        layer.confirm('确实要删除档案吗？', {icon:3, title:'提示'},
                            function(index, layero){
                                delDevice("./collector_del_do.asp", _queryStr, "collector");
                                layer.close(index);
                            });
                    }
                    break;

                case "采集器选择表":
                case "端口选择表":
                    var collectorId = getSelectedRows("jqGrid2");
                    if(collectorId == ""){
                        if(deviceType == "centor")
                            layer.msg("请选择采集器！", {icon: 5});
                        else if(deviceType == "ccentor")
                            layer.msg("请选择端口！", {icon: 5});
                    }else{
                        _layerSize = ['700px', '400px'];
                        _queryStr = [
                            "cmdName="+cmdName,
                            "deviceId="+deviceId,
                            "collectorId="+collectorId
                        ];
                        _myLayui.showLayer(cmdName, "../datamng/OperateDevice/loadAreaMeter.asp", _queryStr, _layerSize);
                    }
                    break;
                case "线路选择表":
                    var readLineId = getSelectedRows("jqGrid1");
                    if(readLineId == ""){
                        layer.msg("请选择抄收线路！", {icon: 5});
                    }else{
                        _layerSize = ['700px', '400px'];
                        _queryStr = [
                            "cmdName="+cmdName,
                            "readLineId="+readLineId
                        ];
                        _myLayui.showLayer(cmdName, "../datamng/OperateDevice/loadAreaMeter.asp", _queryStr, _layerSize);
                    }
                    break;
                case "采集器关联表":
                case "端口关联表":
                    var collectorId = getSelectedRows("jqGrid2");
                    if(collectorId == ""){
                        if(deviceType == "centor")
                            layer.msg("请选择采集器！", {icon: 5});
                        else if(deviceType == "ccentor")
                            layer.msg("请选择端口！", {icon: 5});
                    }else{
                        _layerSize = ['455px', '350px'];
                        _queryStr = [
                            "cmdName="+cmdName,
                            "deviceId="+deviceId,
                            "collectorId="+collectorId
                        ];
                        _myLayui.showLayer(cmdName, "./boundMeter.asp", _queryStr, _layerSize);
                    }
                    break;
                case "线路关联表":
                    var readLineId = getSelectedRows("jqGrid1");
                    if(readLineId == ""){
                        layer.msg("请选择抄收线路！", {icon: 5});
                    }else{
                        _layerSize = ['455px', '350px'];
                        _queryStr = [
                            "cmdName="+cmdName,
                            "readLineId="+readLineId
                        ];
                        _myLayui.showLayer(cmdName, "./boundMeter.asp", _queryStr, _layerSize);
                    }
                    break;
                case "表选择采集器":
                case "表选择端口":
                case "表选择线路":
                    var meterIds = getSelectedRows("jqGrid3");
                    if(meterIds == ""){
                        layer.msg("请选择表！", {icon: 5});
                    }else{
                        _queryStr = [
                            "cmdName="+cmdName,
                            "deviceType="+deviceType,
                            "meterIds="+meterIds
                        ];
                        _myLayui.showLayer(cmdName, "../datamng/OperateDevice/loadCentorCollector.asp", _queryStr, _layerSize);
                    }
                    break;
                default:
                    break;
            }
        });

        $(".layui-btn").click(function(){
            var btnTitle = $(this).data("title");
            if(btnTitle == "查询")
                return;

            if(btnTitle == "导入"){
                var _layerSize = ['500px', '380px'];
                _myLayui.showLayer("设备档案导入","./device_upload.asp", "", _layerSize);
                return false;
            }
        });
    });
</script>
</body>
</html>