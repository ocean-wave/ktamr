<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head title="区域抄表" th:include="include :: header">

</head>
<body  class="myPage-body">
<div class="container myContainer">
	<div class="row" style="margin:0;padding:5px 0px 5px 0px;">
		<div class="col-xs-2 my-form-col">
			<select id='showListType' class="selectpicker form-control" data-style="btn-default btn-sm" title="选择客户类型">
				<option  th:each="entries,stat:${operatorCompnayList}" th:value="${entries['operatorCompanyId']}" th:text="${entries['operatorCompany']}"  th:selected="${stat.index eq 0}"></option>
			</select>
		</div>
		<div class="col-xs-2 my-form-col my-tree-class areaTreeDiv">
			<input id="nodeType" type="text" class="input-sm form-control hide" value="">
			<input id="nodeIds" type="text" class="input-sm form-control hide" value="">
			<input id="areaSel" name="areaSel" type="text" readonly class="input-sm form-control"  placeholder="---请选择区域---"/>
			<div id="menuContent" class="menuContent">
				<div class="ztreeInput">
					<div>
						<input type="text" class="input-key input-sm form-control" id="zTreeKey" placeholder="请输入节点关键字">
					</div>
					<div class="ztreeSkip">
						<label type="text" id="resultKey" class="form-control ztreeSkipLabel">
							<div class="ztreeSkipBtns">
								<a id="clickUp" class="glyphicon glyphicon-menu-up ztreeSkipUp"></a>
								<a id="clickDown" class="glyphicon glyphicon-menu-down ztreeSkipDown"></a>
							</div>
							<label id="number" class="ztreeSkipNum"></label>
						</label>
					</div>
				</div>
				<ul id="areaTree" class="ztree"></ul>
				<div class="clearfloat"></div>
			</div>
		</div>
		<div class="col-xs-1 my-form-col monthType" style="display:none;">
			<select id='monthTypeId' class="selectpicker form-control" data-style="btn-default btn-sm" title="月份类型">
				<option value='' >无</option>
				<option value='S' >单月</option>
				<option value='D' >双月</option>
			</select>
		</div>
		<div class="col-xs-1 my-form-col dateRange" style="display:none;">
			<input  id="queryMonth" class="input-sm form-control" type="text" value='' readonly="readonly" placeholder="选择查询月份"/>
		</div>
		<div class="col-xs-2 my-form-col">
			<input class="input-sm form-control" type="text" id="keyWord" size="10" placeholder="请输入关键字">
		</div>
		<div class="col-xs-1 my-form-col">
			<button data-modal="" data-title="查询" class="layui-btn layui-btn-normal layui-btn-sm search"><span class="glyphicon glyphicon-search"></span> 查询</button>
		</div>
		<div class="my-btns pull-right btns1" style="display:none;">
			<button data-modal="" data-title="DBF文件" class="layui-btn layui-btn-sm"><span class="glyphicon glyphicon-download"></span>&nbsp;DBF文件</button>
		</div>
		<div class="my-btns pull-right btns2" style="display:none;">
			<button data-modal="" data-title="TXT文件" class="layui-btn layui-btn-sm"><span class="glyphicon glyphicon-download"></span>&nbsp;TXT文件</button>
		</div>
		<div class="my-btns pull-right btns3" style="display:none;">
			<button data-modal="" data-title="数据上传" class="layui-btn layui-btn-sm"><span class="glyphicon glyphicon-upload"></span>&nbsp;数据上传</button>
		</div>
	</div>
	<div class="row my-form-no-edge">
		<div class="col-md-12 my-form-no-edge">
			<form class="form-horizontal" id="jqgridForm" role="form">
				<table id="jqGrid" rel="jqgridForm" class="jqgrid"></table>
				<div id="jqGridPager"></div>
			</form>
		</div>
	</div>
</div>
<div th:include="include :: footer"></div>
<script th:inline="javascript">
	layui.config({
		base : '/common/js/',
		version: '2.8.2'
	}).extend({
		myLayui: 'myLayui'
	});
	layui.use(['element','layer', 'myLayui'], function(){
		var element = layui.element,
				myLayui = layui.myLayui,
				layer = layui.layer;
		var g_showListType = $("#showListType").val();
		var zOption = {
			url: "/nodes/getEquipmentNodes",
			selectedMulti: true,
			nodeTypeId: "nodeType",
			nodeIdsId: "nodeIds",
			nodeNamesId: "areaSel",
			clickCallBack: ""
		};

		var tree = new myzTree("areaTree", zOption);
		tree.dropDownTreeOpen();
		tree.fuzzySearch("zTreeKey", "clickUp", "clickDown", "number");
		$("#areaSel").click(function(){
			tree.showMenu();
		});

		$('.selectpicker').selectpicker({
			actionsBox: true //保留全选,全不选按键
			,noneSelectedText: '请选择'
			,selectAllText: '选择所有'
			,deselectAllText: '取消全选'
			,liveSearchPlaceholder: '搜索'
		});

		$('#queryMonth').datetimepicker({
			language: 'zh-CN',//显示中文
			format: 'yyyy-mm',//显示格式
			startView: 3,//首先显示的视图, 0当前时的分钟区间 1该天的每时 2该月的每天 3该年的每月 4年视图
			minView: "month",//设置只显示到月份
			initialDate: new Date(),//初始化当前日期
			autoclose: true,//选中自动关闭
			todayBtn: true//显示今日按钮
		});

		function companyChange(showListType){
			$(".monthType").hide();
			$(".dateRange").hide();
			$(".my-btns").hide();
			if(showListType == "sys_zjss"){
				$(".btns1").show();
			}else if(showListType == "sys_tzss"){
				$(".monthType").show();
				$(".dateRange").show();
				$(".btns2").show();
			}else if(showListType == "sys_rass"){
				$(".btns2").show();
			}else if(showListType == "sys_jrss"){
				$(".btns3").show();
			}
		}
		function showjqGridList(showListType){
			var GridObj = new myJqGrid("jqGrid", "jqGridPager", "jqgridForm", 115,'/thirdpartydata/thirdPartyReportJson');
			if(showListType == "sys_ntrq"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterId','用户号','表地址','用户名','用户地址','最近读数','最近抄表时间','表状态'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterId',  width: 75, key: true, hidden: true},
					{ name: 'havMeterinfo.userNo', width: 100, formatter:'interger' },
					{ name: 'addr', width: 150 },
					{ name: 'havMeterinfo.userName', width: 150 },
					{ name: 'havMeterinfo.userDs', width: 200 },
					{ name: 'thNumber', align: 'right' ,width: 80 },
					{ name: 'thRTime', align: 'right' ,width: 150 },
					{ name: 'state', width: 90, cellattr: MeterStateCellColor },
				];
				GridObj.jqdefaultGridConfig.gridComplete = function(){MeterStateRowColor("jqGrid", "state")};
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_hsss"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterId','用户编号','用户名','水表编号','用户地址','房号','读数','抄表时间'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterId',  width: 75, key: true, hidden: true},
					{ name: 'havMeterinfo.userNo', width: 100, formatter:'interger' },
					{ name: 'havMeterinfo.userName', width: 150 },
					{ name: 'meterNumber', align: 'right', width: 140 },
					{ name: 'havMeterinfo.userDs', width: 200 },
					{ name: 'haRoom.name', width: 80 },
					{ name: 'thNumber', align: 'right' ,width: 80 },
					{ name: 'thRTime',width: 150 }
				];
				GridObj.drawGrid();
			//	GridObj.gridComplete();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();

			}else if(showListType == "sys_zjss" || showListType == ""){
				showListType = "sys_zjss";
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterId','用户编号','水表编号','用户地址','读数','抄表时间'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterId',  width: 75, key: true, hidden: true},
					{ name: 'havMeterinfo.userNo', width: 100, formatter:'interger' },
					{ name: 'meterNumber', align: 'right', width: 140 },
					{ name: 'havMeterinfo.userDs', width: 200 },
					{ name: 'thNumber', align: 'right' ,width: 80 },
					{ name: 'thRTime',width: 150 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_tzss"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterId','用户编号','用户名称','本次度数','抄表日期','用量','增减水量','状态','上次度数'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterId',  width: 75, key: true, hidden: true},
					{ name: 'havMeterinfo.userNo', width: 100},
					{ name: 'name', width: 100},
					{ name: 'haFreeze.tfNumber', align: 'right', width: 80 },
					{ name: 'haFreeze.thTime', width: 150 },
					{ name: 'haFreeze.delta', align: 'right', width: 80 },
					{ name: 'zjsl', align: 'right', width: 80 },
					{ name: 'state',width: 80 },
					{ name: 'haFreeze.lfNumber', align: 'right', width: 80 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_pkss"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterId','销账号','水费年月','上月抄见数','本月抄见数','抄见日期','用水量','远传表水表编号','初始导入标记'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterId',  width: 75, key: true, hidden: true},
					{ name: 'havMeterinfo.userNo', width: 100, formatter:'interger' },
					{ name: 'sfny', align: 'right', width: 100 },
					{ name: 'sycjs', align: 'right', width: 100 },
					{ name: 'thNumber', align: 'right' , width: 100 },
					{ name: 'thRTime',width: 150 },
					{ name: 'ysl', align: 'right', width: 80 },
					{ name: 'meterNumber', align: 'right' , width: 120 },
					{ name: 'csdrbj', align: 'right', width: 120 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_rass"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterId','用户编号','抄收读数','抄表日期'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterId',  width: 75, key: true, hidden: true},
					{ name: 'havMeterinfo.userNo', width: 100, formatter:'interger' },
					{ name: 'thNumber', align: 'right', width: 80 },
					{ name: 'cbrq', width: 150 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_jrss"){
				companyChange(showListType);
				var mounthStr = new Date().Format("yyyyMM");
				GridObj.ExcelFileName = 'YC'+ mounthStr;
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterId','用户编号','上次抄表读数','本次抄表读数','抄见水量','抄表日期'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterId',  width: 75, key: true, hidden: true},
					{ name: 'havMeterinfo.userNo', width: 100, formatter:'interger' },
					{ name: 'amtabnum', align: 'right', width: 100 },
					{ name: 'thNumber', align: 'right', width: 100 },
					{ name: 'watermete', align: 'right' ,width: 80 },
					{ name: 'cbtdate',width: 150 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_hncc"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterId','用户编号','用户名称','表号','表底数','账户余额'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterId',  width: 75, key: true, hidden: true},
					{ name: 'havMeterinfo.userNo', width: 100 },
					{ name: 'havMeterinfo.userName', width: 100 },
					{ name: 'meterNumber', align: 'right', width: 100 },
					{ name: 'lfNumber', align: 'right', width: 80 },
					{ name: 'haRoom.custom.balance', align: 'right', width: 80 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_nyss"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterId','表号','用户编号','抄收时间','读数'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterId',  width: 75, key: true, hidden: true},
					{ name: 'meterNumber', width: 100 },
					{ name: 'havMeterinfo.userNo', width: 100 },
					{ name: 'thRTime', width: 100 },
					{ name: 'thNumber', align: 'right', width: 100 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_hcss"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['id','用户编号','水表编号','抄表时间','上期度数','本期度数','追加水量'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'id',  width: 75, key: true, hidden: true},
					{ name: '用户编号', width: 100 },
					{ name: '水表编号', width: 80 },
					{ name: '抄表时间', width: 140 },
					{ name: '上期度数', align: 'right', width: 80 },
					{ name: '本期度数', align: 'right', width: 80 },
					{ name: '追加水量', align: 'right', width: 80 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_ahqj"){
				companyChange(showListType);
				var mounthStr = new Date().Format("yyyyMM");
				GridObj.ExcelFileName = '10'+ mounthStr + 'S';
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['id','用户编号','用户名称','用户地址','手机号码','表号','线路号','小区ID','抄表员ID','上月抄表读数','本月抄表读数','用水量','水费单价','抄表日期'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'id',  width: 75, key: true, hidden: true},
					{ name: 'UserID', width: 100 },
					{ name: 'UserName', width: 80 },
					{ name: 'Address', width: 140 },
					{ name: 'Tel',  width: 80 },
					{ name: 'WaterTagID', width: 80 },
					{ name: 'LineNo',  width: 80 },
					{ name: 'AreaID',  width: 80 },
					{ name: 'InTabManID', width: 80 },
					{ name: 'AMTabNum', align: 'right', width: 80 },
					{ name: 'NMTabNum', align: 'right', width: 80 },
					{ name: 'WaterMete', align: 'right', width: 80 },
					{ name: 'WaterPrice',  width: 80 },
					{ name: 'CBtDate',  width: 80 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_whyw"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterid','用户编号','名称','抄表年月','旧表本次抄表指数','新表基数','新表读数','是否换表','抄表时间','更新时间','抄表员','计费标记'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterid',  width: 75, key: true, hidden: true},
					{ name: '用户编号', width: 100, formatter:'interger' },
					{ name: '名称', align: 'right', width: 140 },
					{ name: '抄表年月', width: 70 },
					{ name: '旧表本次抄表指数', align: 'right' ,width: 80 },
					{ name: '新表基数', align: 'right' ,width: 70 },
					{ name: '新表读数', align: 'right' ,width: 70 },
					{ name: '是否换表', align: 'right' ,width: 70 },
					{ name: '抄表时间', width: 150 },
					{ name: '更新时间', width: 150 },
					{ name: '抄表员', width: 70 },
					{ name: '计费标记', width: 70}
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_ynsw"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterid','序号','业主编号','业主名称','地址','表类型','表号','读数','抄收时间'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterid',  width: 75, key: true, hidden: true},
					{ name: '序号', width: 75, formatter:'interger' },
					{ name: '业主编号', width: 100, formatter:'interger' },
					{ name: '业主名称', align: 'right', width: 100 },
					{ name: '地址', width: 140 },
					{ name: '表类型', align: 'right' ,width: 70 },
					{ name: '表号', align: 'right' ,width: 120 },
					{ name: '读数', align: 'right' ,width: 70 },
					{ name: '抄收时间', width: 150 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_bnss"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterid','安装地址','用户编号','表具编号','上级设备','今日止度','表具口径','表具状态','抄读方式','状态代码'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterid',  width: 75, key: true, hidden: true},
					{ name: '安装地址', width: 150 },
					{ name: '用户编号', width: 100 },
					{ name: '表具编号', align: 'right', width: 100 },
					{ name: '上级设备', align: 'right', width: 100 },
					{ name: '今日止度', align: 'right' ,width: 70 },
					{ name: '表具口径', align: 'right' ,width: 70 },
					{ name: '表具状态' ,width: 70 },
					{ name: '抄读方式', width: 70 },
					{ name: '状态代码', width: 70 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_dzss"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterid','客户号','户主姓名','用户地址','上次表数','本次表数','抄表时间','抄表员号'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterid',  width: 75, key: true, hidden: true},
					{ name: '客户号', width: 100 },
					{ name: '户主姓名', align: 'right', width: 140 },
					{ name: '用户地址', width: 200 },
					{ name: '上次表数', align: 'right' ,width: 80 },
					{ name: '本次表数', align: 'right' ,width: 80 },
					{ name: '抄表时间',width: 150 },
					{ name: '抄表员号',width: 80 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}else if(showListType == "sys_xtss"){
				companyChange(showListType);
				GridObj.unloadGrid();
				GridObj.removeGridResize();
				GridObj.jqdefaultGridConfig.caption = "";
				GridObj.jqdefaultGridConfig.multiselect = false;
				GridObj.jqdefaultGridConfig.postData = {"params[showListType]": showListType};
				GridObj.jqdefaultGridConfig.colNames = ['meterid','用户编号','抄表月份','抄表时间','本次采集读数','抄见类别','同步时间','厂家编码'];
				GridObj.jqdefaultGridConfig.colModel = [
					{ name: 'meterid',  width: 75, key: true, hidden: true},
					{ name: 'METER_CODE', align: 'right', width: 100 },
					{ name: 'COLL_MONTH', align: 'right', width: 100 },
					{ name: 'COLL_TIME', width: 150 },
					{ name: 'COLL_VALUE', align: 'right' ,width: 80 },
					{ name: 'READED_TYPE', align: 'right' ,width: 80 },
					{ name: 'READ_TIME', width: 150 },
					{ name: 'METERBRAND', width: 80 }
				];
				GridObj.drawGrid();
				GridObj.drawGridPager();
				GridObj.setGridSize();
				GridObj.gridResize();
			}
		}

		showjqGridList(g_showListType);
		$(document).keydown(function(event){
			if(event.keyCode==13){
				$(".search").click();
			}
		});
		$("#showListType").change(function(){
			var showListType = $("#showListType").val();
			showjqGridList(showListType);
		});

		$(".search").click(function(){
			var _showListType = $("#showListType").val();
			var  _pdArray = "";
			_pdArray = {
				"params[keyWord]": $("#keyWord").val(),
				"params[showListType]": _showListType,
				"params[nodeType]": $("#nodeType").val(),
				"params[nodeIds]": $("#nodeIds").val(),
				"params[monthType]": $("#monthTypeId").val(),
				"params[queryMonth]": $("#queryMonth").val()
			};
			fullTextSearch("jqGrid", _pdArray);
		});

		var loadLayerIndex=0;
		function showLoadLayer(){
			return layer.msg('努力中...', {icon: 16,shade: [0.5, '#f5f5f5'],scrollbar: false, time:180*1000}) ;
		}
		function exportToFile(pUrl, pData){
			$.ajax({
				url: pUrl
				,type: "POST"
				,contentType:'application/x-www-form-urlencoded; charset=UTF-8'
				,data: pData
				,async: false
				,success: function(data){
					if(data.code == "0"){
						window.location.href = ctx + "common/download?fileName=" + encodeURI(data.msg)+"&delete="+true;
					}else{
						layer.msg(data, { icon: 5 });
					}
				}
			});
		}

		var _myLayui = new myLayui;
		$(".layui-btn").click(function(){
			var btnTitle = $(this).data("title");
			var showListType = $("#showListType").val();
			var url="";
			var data={};
			var nodeType=$("#nodeType").val()
			var nodeIds=$("#nodeIds").val();
			if(btnTitle == "查询")
				return;
			if(btnTitle == "DBF文件" || btnTitle == "TXT文件"){

				postData = "";
				if(nodeIds == ""){
					layer.msg("请选择区域", { icon: 5 });
					return false;
				}

				if(showListType == "sys_tzss"){
					url = "TaiZhou/exportToTXT.asp";
					if(!$("#queryMonth").val()){
						layer.msg("请选择月份", { icon: 5 });
						return false;
					}
					postData = {
						"nodeType": nodeType,
						"nodeIds": nodeIds,
						"monthType": $("#monthTypeId").val(),
						"queryMonth": $("#queryMonth").val()
					}
					loadLayerIndex = showLoadLayer();
				}else if(showListType == "sys_zjss"){
					url = "ZhenJiang/exportToDBF.asp";
					postData = {
						"nodeType": nodeType,
						"nodeIds": nodeIds
					}
				}else if(showListType == "sys_rass"){
					url = "/thirdpartydata/exportToTXT";
					postData = {
						"nodeType": nodeType,
						"nodeIds": nodeIds
					}
				}
				var colNames = $("#jqGrid").jqGrid("getGridParam", "colNames");
				var colModel = $("#jqGrid").jqGrid("getGridParam", "colModel");
				var name = new Array();
				var reg=/[\u4E00-\u9FA5]/;
				for(var i = 0;i<colNames.length;i++){
					if(colNames != null && reg.exec(colNames[i])){
						name.push(colModel[i].name)
					}
				}
				postData["name"]=name;
				postData["params[showListType]"]=showListType;
				exportToFile(url, postData);

				return false;
			}else if(btnTitle == "数据上传" && showListType == "sys_jrss"){
				var _layerSize = ['500px', '320px'];
				_myLayui.showLayer("用户抄表数据导入导出","./JuRong/users_upload.asp", "", _layerSize);
				return false;
			}
		});
	});
</script>
</body>
</html>
